# network-computing
the homework of network computing class
---

## 上机报告

#### 上机题目及上机内容

#### 小组名单以及各自工作内容

#### 协议设计

##### 客户端如何定位服务器

客户端固定域名，使用域名解析得到的 IP 来定位服务器，服务端使用固定端口号 4000。

##### 协议格式

基于 TCP 的应用层协议。TCP 是基于点到点的可靠的传输层协议，无需考虑应用层协议的一致性问题。采用基于 Key-Value 模式的 JSON 数据格式实现。

###### 登录

客户端请求参数:

| 参数       | 意义    | 备注      |
| -------- | ----- | ------- |
| type     | 协议类型  | 值为 "00" |
| bankcard | 银行卡号  |         |
| password | 银行卡密码 |         |

服务端返回参数:

| 参数         | 意义             | 备注            |
| ---------- | -------------- | ------------- |
| type       | 协议类型           | 值为 "00"       |
| status     | 状态标志           | 0 代表成功，1 代表失败 |
| token      | 会话标识           |               |
| expiration | 到期时间           |               |
| msg        | 错误消息，仅失败的时候不为空 |               |

大致流程:

1. 客户端使用银行卡号与密码请求登录
2. 服务端收到请求后，验证银行卡号与密码
3. 验证成功后，服务端会签发一个 token，再把这个 token 发送给客户端；若验证失败，则返回错误原因
4. 客户端收到 token 后把它存储起来，每次向服务端请求资源的时候带着服务端签发的 token
5. 服务端收到请求后，验证客户端请求里面的 token
6. 服务端返回消息时，也会带上 token

关于参数 token:

* 每次打开客户端，都会发起登录请求，获取新的 token
* 因客户端崩溃导致 token 的存在，客户端登录成功后覆盖之
* 关闭客户端，即删除当前的 token

关于参数 expiration:

* 初始值为一天(86400秒)，每秒减 1
* 值为 300 的时候，客户端发起**续期**请求
* 值为 0 的时候，token 无效，服务端删除该值

示例:

```json
/* Client 请求格式 */
{
    "tpye": "00",
    "bankcard": "0123456789",
    "password": "0123456789"
}

/* Server 返回格式 */
{
    "type": "01",
    "status": "0",
    "token": "1995172d456c6f0266142f8175eaafca",
    "expiration": "86400",
    "msg": ""
}
```

###### 续期

客户端请求参数:

| 参数       | 意义   | 备注    |
| -------- | ---- | ----- |
| type     | 协议类型 | 值为 10 |
| token    | 会话标识 |       |
| bankcard | 银行卡号 |       |

服务端返回参数:

| 参数     | 意义             | 备注            |
| ------ | -------------- | ------------- |
| type   | 协议类型           | 值为 11         |
| token  | 会话标识           |               |
| status | 状态标志           | 0 代表成功，1 代表失败 |
| msg    | 错误消息，仅失败的时候不为空 |               |

大致流程:

1. expiration 值为 300 的时候，客户端发起续期请求
2. 服务端接收到该请求后，设置这 token 的 expiration 为 86400，同时返回给服务端成功状态
3. 服务端接收到请求后，设置 expiration 为 86400

示例:

```json
/* Client 请求格式 */
{
    "type": "10",
    "token": "1995172d456c6f0266142f8175eaafca",
    "bankcard": "0123456789"
}

/* Server 返回格式 */
{
    "type": "11",
    "token": "1995172d456c6f0266142f8175eaafca",
    "status": "0",
    "msg": ""
}
```

###### 存款

客户端请求参数:

| 参数       | 意义   | 备注    |
| -------- | ---- | ----- |
| type     | 协议类型 | 值为 20 |
| token    | 会话标识 |       |
| bankcard | 银行卡号 |       |
| amount   | 金额   |       |

服务端返回参数:

| 参数     | 意义             | 备注            |
| ------ | -------------- | ------------- |
| type   | 协议类型           | 值为 21         |
| token  | 会话标识           |               |
| status | 状态标志           | 0 代表成功，1 代表失败 |
| msg    | 错误消息，仅失败的时候不为空 |               |

大致流程:

1. 客户端发起存款请求
2. 服务端验证账户是否有效
3. ...

示例:

```json
/* Client 请求格式 */
{
    "type": "20",
    "token": "1995172d456c6f0266142f8175eaafca",
    "bankcard": "0123456789",
    "amount": "100"
}

/* Server 返回格式 */
{
    "type": "21",
    "token": "1995172d456c6f0266142f8175eaafca",
    "status": "0",
    "msg": ""
}
```

###### 取款

客户端请求参数:

| 参数       | 意义   | 备注    |
| -------- | ---- | ----- |
| type     | 协议类型 | 值为 30 |
| token    | 会话标识 |       |
| bankcard | 银行卡号 |       |
| amount   | 金额   |       |

服务端返回参数:

| 参数     | 意义             | 备注            |
| ------ | -------------- | ------------- |
| type   | 协议类型           | 值为 31         |
| token  | 会话标识           |               |
| status | 状态标志           | 0 代表成功，1 代表失败 |
| msg    | 错误消息，仅失败的时候不为空 |               |

大致流程:

1. 客户端发起存款请求
2. 服务端验证账户是否有效
3. ...

示例:

```json
/* Client 请求格式 */
{
    "type": "30",
    "token": "1995172d456c6f0266142f8175eaafca",
    "bankcard": "0123456789",
    "amount": "100"
}

/* Server 返回格式 */
{
    "type": "31",
    "token": "1995172d456c6f0266142f8175eaafca",
    "status": "0",
    "msg": ""
}
```

###### 转账

客户端请求参数:

| 参数          | 意义        | 备注    |
| ----------- | --------- | ----- |
| type        | 协议类型      | 值为 40 |
| token       | 会话标识      |       |
| bankcard    | 银行卡号      |       |
| transferred | 转入账户的银行卡号 |       |
| amount      | 金额        |       |

服务端返回参数:

| 参数     | 意义             | 备注            |
| ------ | -------------- | ------------- |
| type   | 协议类型           | 值为 41         |
| token  | 会话标识           |               |
| status | 状态标志           | 0 代表成功，1 代表失败 |
| msg    | 错误消息，仅失败的时候不为空 |               |

大致流程:

1. 客户端发起存款请求
2. 服务端验证账户是否有效
3. ...

示例:

```json
/* Client 请求格式 */
{
    "type": "40",
    "token": "1995172d456c6f0266142f8175eaafca",
    "bankcard": "0123456789",
    "transferred": "1234567890",
    "amount": "100"
}

/* Server 返回格式 */
{
    "type": "41",
    "token": "1995172d456c6f0266142f8175eaafca",
    "status": "0",
    "msg": ""
}
```

#### 上机题目完成过程中碰到的问题

* 事物操作中客户端或服务端崩溃了怎么办？

#### 上机题目最终测试报告

#### 思考题

* 帐号路由功能的实现
* 交叉互连（与其他小组开发的模拟系统连接）的结果预估
* 应用层协议的作用
* 对 C/S 计算模式的认识
* 对课程内容设置、讲授方式及教师课堂讲解的意见和建议

